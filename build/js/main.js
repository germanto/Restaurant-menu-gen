"use strict";var createMenu={settings:{addSection:document.querySelector("._JS_addSection"),addItem:document.querySelector("._JS_addItem"),menuSection:document.querySelector("._JS_menuSection"),menuItem:document.querySelector("._JS_menuItem"),miContainer:document.querySelector("._JS_menuItemContainer"),menuSectionTemplate:document.querySelector("#_JS_menuSection"),menuItemTemplate:document.querySelector("#_JS_menuItem"),deleteButton:"_JS_deleteButton",dataCollection:{restName:void 0,title:void 0,sections:[]},menuWorker:new Worker("/build/js/worker.js")},init:function(){var e=this,t=this.settings;void 0!==window.localStorage.menu&&this.restoreSavedMenu(),document.querySelector("._JS_downloadMenu").addEventListener("click",function(){e.downloadMenu(document.querySelector("._JS_menuPreview").innerHTML,t.dataCollection.title)}),document.querySelector("._JS_menuPreview").addEventListener("click",function(t){e.togglePreviewWindow(t.target)}),t.menuWorker.addEventListener("message",function(t){e.updateMenuHTML(t.data,"receive")}),document.body.addEventListener("click",function(n){n.target.classList.contains("_JS_addSection")?(n.preventDefault(),e.createContent(n.target,t.menuSectionTemplate,"menuSection")):n.target.classList.contains("_JS_addItem")?(n.preventDefault(),e.createContent(n.target,t.menuItemTemplate,"menuItem")):n.target.classList.contains(t.deleteButton)&&(e.deleteContent(n),e.saveMenu())}),document.body.addEventListener("change",function(n){"raw"===n.target.id?n.target.checked?t.dataCollection.containsRaw=!0:t.dataCollection.containsRaw=!1:e.dataCollector(n.target),e.saveMenu()}),document.querySelector("._JS_reset").addEventListener("click",function(){e.resetAll()})},createContent:function(e,t,n){var i=t.content.cloneNode(!0),o=Math.round(Date.now()/100).toString();i.querySelector("section").setAttribute("data-"+n,o),e.parentElement.replaceChild(i,e)},deleteContent:function(e){var t=this.settings;if(window.confirm("Are you sure you'd like to delete this?")){var n=e.target.parentElement,i=n.parentElement;t.dataCollection.sections.some(function(n,i){return e.target.parentElement.classList.contains("_JS_menuItemContainer")?n.items.some(function(n,o){n.id===e.target.parentElement.getAttribute("data-menuitem")&&t.dataCollection.sections[i].items.splice(o,1)}):void(n.id===e.target.parentElement.getAttribute("data-menusection")&&t.dataCollection.sections.splice(i,1))}),i.removeChild(n)}},dataCollector:function(e){var t=e.getAttribute("data-identifier"),n=e.value,i=this.settings.dataCollection,o=void 0,r=void 0,a=void 0,u=void 0;switch(t){case"restaurantName":i.restName=n;break;case"menuTitle":i.title=n;break;case"menuSection":o=this.findParentAttribute("data-menusection",e),a=i.sections.length>0&&i.sections.some(function(e){return e.id===o?(e.name=n,!0):void 0}),a||i.sections.push({id:o,name:n,items:[]});break;case"menuItem":r=this.findParentAttribute("data-menusection",e),o=this.findParentAttribute("data-menuitem",e),i.sections.some(function(e){return e.id===r?(u=e.items.length>0&&e.items.some(function(e){return e.id===o?(e.name=n,!0):void 0}),u||e.items.push({id:o,name:n,price:void 0,description:void 0}),!0):void 0});break;case"menuItemPrice":this.insertMenuDetails("price",e,i,n);break;case"menuItemDesc":this.insertMenuDetails("description",e,i,n)}},saveMenu:function(){var e=this.settings,t=JSON.stringify(e.dataCollection);localStorage.setItem("menu",t),this.updateMenuHTML(t,"send")},findParentAttribute:function(e,t){return t.hasAttribute(e)?t.getAttribute(e):this.findParentAttribute(e,t.parentElement)},insertMenuDetails:function(e,t,n,i){var o=this.findParentAttribute("data-menuitem",t);n.sections.some(function(t){return t.items.some(function(t){return t.id===o?(t[e]=i,!0):void 0})})},updateMenuHTML:function(e,t){var n=this.settings,i=document.querySelector("._JS_menuPreview");"send"===t?n.menuWorker.postMessage(e):(i.innerHTML="",i.insertAdjacentHTML("afterbegin",e))},togglePreviewWindow:function(e){e.classList.toggle("showPreview")},downloadMenu:function(e,t){alert('The menu should download immediately, but you may need to manually save it as an HTML document with the ".html" file extension');var n=document.createElement("a"),i=new Blob([e],{type:"text/html"}),o=window.URL.createObjectURL(i);try{document.body.appendChild(n),n.style="display: none",n.href=o,n.download=t,n.click()}catch(r){window.location=o}},restoreSavedMenu:function(){var e=this,t=this.settings,n=JSON.parse(window.localStorage.menu);t.dataCollection=n,document.querySelector("#raw").checked=n.containsRaw===!0?"checked":null,document.querySelector('[data-identifier="restaurantName"]').value=n.restName||"",document.querySelector('[data-identifier="menuTitle"]').value=n.title||"",n.sections.forEach(function(n,i){e.createContent(document.querySelector("._JS_addSection"),t.menuSectionTemplate,"menuSection"),document.querySelectorAll(".form_menuSection")[i].setAttribute("data-menusection",n.id),document.querySelectorAll('[data-identifier="menuSection"]')[i].value=n.name||"",n.items.forEach(function(n,o){e.createContent(document.querySelectorAll(".form_menuSection")[i].querySelector("._JS_addItem"),t.menuItemTemplate,"menuItem"),document.querySelectorAll(".form_menuSection")[i].querySelectorAll("._JS_menuItemContainer")[o].setAttribute("data-menuitem",n.id),document.querySelectorAll(".form_menuSection")[i].querySelectorAll('[data-identifier="menuItem"]')[o].value=n.name||"",document.querySelectorAll(".form_menuSection")[i].querySelectorAll('[data-identifier="menuItemPrice"]')[o].value=n.price||"",document.querySelectorAll(".form_menuSection")[i].querySelectorAll('[data-identifier="menuItemDesc"]')[o].value=n.description||""})}),this.saveMenu()},resetAll:function(){confirm("Are you sure? All Data will be lost!")&&(localStorage.removeItem("menu"),window.location.reload())}};createMenu.init();